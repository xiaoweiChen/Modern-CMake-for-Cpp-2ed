
\documentclass[11pt,a4paper,UTF8]{book}

\interfootnotelinepenalty=10000

\usepackage{textcomp}
\usepackage{verbatim}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{authblk}

\usepackage{fontspec}                  %引入字体设置宏包
%\setmainfont{Times New Roman}             %设置英文正文字体
% Courier New
% Book Antique
%\setmainfont{Courier New}
% https://github.com/source-foundry/Hack-windows-installer/releases/tag/v1.6.0
\setmainfont{Hack}
%\setsansfont{Arial}                    %英文无衬线字体
%\setmonofont{Courier New}              %英文等宽字体

\usepackage{ctex} %导入中文包
%\usepackage{ulem}
\usepackage{tocvsec2}

% https://github.com/notofonts/noto-cjk/releases 思源宋体
% https://github.com/adobe-fonts/source-han-serif/releases
% https://github.com/adobe-fonts/source-han-sans 思源黑体
% 解压完成后放至texlive的字体目录下，例如 D:\Program Files\texlive\2023\texmf-dist\fonts\opentype\public dir
% 查看可用的中文字体的命令： fc-list :lang=zh
% https://blog.amito.me/2015/10/Setup-Chinese-Environment-with-XeTeX/
\setCJKmainfont{SourceHanSansSC-Medium} % "SC" 表示简体中文版本

\usepackage{tabularx}
\usepackage{longtable}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{bbding}
\usepackage{float}
\usepackage{xspace}
\usepackage[none]{hyphenat}
\usepackage{pgffor}

\usepackage{graphicx}
\usepackage{subfigure}
\usepackage{pifont}

\usepackage{hyperref}  %制作pdf的目录
\usepackage{subfiles} %使用多文件方式进行

\usepackage{geometry} %设置页边距的包
\geometry{left=2.5cm,right=2cm,top=2.54cm,bottom=2.54cm} %设置书籍的页边距

\usepackage{url}
\hypersetup{hidelinks, %去红框
    colorlinks=true,
    allcolors=black,
    pdfstartview=Fit,
    breaklinks=true
}

% 调整itemlist中的行间距
\usepackage{enumitem}
\setenumerate[1]{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=5pt}
\setitemize[1]{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=5pt}
\setdescription{itemsep=0pt,partopsep=0pt,parsep=\parskip,topsep=5pt}

% 超链接样式设置
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=blue,
    urlcolor=blue,
    citecolor=cyan,
}

\usepackage{indentfirst}

\usepackage{listings}
\usepackage[usenames,dvipsnames,svgnames, x11names]{xcolor}
\usepackage{wallpaper}

\usepackage[most]{tcolorbox}
\tcbuselibrary{breakable, minted, skins}

%https://tex.stackexchange.com/questions/173850/problem-in-adding-a-background-color-in-a-minted-environment
\newtcblisting{shell}{
    listing engine=minted,
    minted language=text,%bash, % 使用text就不会有语法高亮显示
    minted options={autogobble,linenos,breaklines},
    listing only,
    size=title,
    arc=0.3mm,
    breakable,
    enhanced jigsaw,
    colframe=black!50!white,
    boxrule=0.5mm,
    colback=bashcodebg,
    coltext=Black,
    minted options={linenos=false,texcl=true},
}
\definecolor{bashcodebg}{rgb}{0.85,0.85,0.85}

% https://tex.stackexchange.com/questions/304449/combine-minted-and-tcolorbox-for-code-from-file-inputminted
\newcounter{inputPrg}
\newtcblisting[use counter=inputPrg, number format=\arabic]{cpp}{
    listing engine=minted,
    minted language=c++,
    minted options={autogobble,linenos,breaklines},
    listing only,
    size=title,
    arc=0.5mm,
    breakable,
    enhanced jigsaw,
    colframe=black!7!white,
    %coltitle=White,
    boxrule=0.5mm,
    colback=blue!3!white,
    coltext=Black,
    %title=\TwoSymbolsAndText{\faCode}{%
        %    \textbf{Input program \thetcbcounter}\ifthenelse{\equal{#2}{}}{}{\textbf{:} \textit{#2}}%
        %}{\faCode},
    %label=inputPrg:#3
    left=6.5mm,enhanced,
    overlay={\begin{tcbclipinterior}\fill[black!5] (frame.south west)
            rectangle ([xshift=5mm]frame.north west);\end{tcbclipinterior}}
}

\usepackage{tikz}

% URL 正确换行
% https://liam.page/2017/05/17/help-the-url-command-from-hyperref-to-break-at-line-wrapping-point/
\makeatletter
\def\UrlAlphabet{%
    \do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j%
    \do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t%
    \do\u\do\v\do\w\do\x\do\y\do\z\do\A\do\B\do\C\do\D%
    \do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N%
    \do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X%
    \do\Y\do\Z}
\def\UrlDigits{\do\1\do\2\do\3\do\4\do\5\do\6\do\7\do\8\do\9\do\0}
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\g@addto@macro{\UrlBreaks}{\UrlAlphabet}
\g@addto@macro{\UrlBreaks}{\UrlDigits}
\makeatother

% enable subsubsubsection
% from https://tex.stackexchange.com/练习题/274212/correct-hierarchy-levels-of-pdf-bookmarks-for-custom-section-subsubsubsection
\usepackage[depth=3]{bookmark}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{4}
\hypersetup{bookmarksdepth=4}

% 去除minted代码块中的红框
% https://tex.stackexchange.com/questions/343494/minted-red-box-around-greek-characters
\AtBeginEnvironment{minted}{\dontdofcolorbox}
\def\dontdofcolorbox{\renewcommand\fcolorbox[4][]{##4}}

% minted中选中代码添加背景
% https://stackoverflow.com/questions/66609265/highlighting-background-of-code-inside-a-minted-environment

% minted中选中代码粗体
% https://tex.stackexchange.com/questions/393526/bold-letters-within-minted-bash-text

\makeatletter

\newcommand{\toclevel@subsubsubsection}{4}
\newcounter{subsubsubsection}[subsubsection]

\renewcommand{\thesubsubsubsection}{\thesubsubsection.\arabic{subsubsubsection}}

\newcommand{\subsubsubsection}{\@startsection{subsubsubsection}{4}{\z@}%
    {-3.25ex\@plus -1ex \@minus -.2ex}%
    {1.5ex \@plus .2ex}%
    {\normalfont\normalsize\bf\bfseries}}

\newcommand*{\l@subsubsubsection}{\@dottedtocline{4}{11em}{5em}}

\newcommand{\subsubsubsectionmark}[1]{}
\makeatother


\makeatletter
\newcommand{\savefootnote}[1]{%
    \protected@xdef\@thefnmark{#1}%
    \global\let\@sf@label\@currentlabel
}
\newcommand{\usefootnote}{%
    \footnotemark[\@sf@label]%
}
\makeatother

\ExplSyntaxOn

% Setup enumerate, itemize and description
\setenumerate  { nosep }
\setitemize    { nosep }
\setdescription{ nosep }

% Setup minted
\setminted { obeytabs, tabsize=2, breaklines=true, fontsize=\footnotesize}

% Def \filename
\NewDocumentCommand { \filename } { m }
{ \noindent  \hspace*{\fill} \\ \textit { #1 } \vspace*{ -1ex } \nopagebreak[4] }

% Def \mySamllsection
\NewDocumentCommand { \mySamllsection } { m }
{\vspace{ 0.2cm } \noindent \textbf { #1 } \vspace*{ 0.05cm } \nopagebreak[4]
 \addcontentsline{toc}{paragraph}{\hspace{0.5cm}{#1}}
}

\NewDocumentCommand { \mySamllsubsection } { m }
{\vspace{ 0.2cm } \noindent \textbf { #1 } \vspace*{ 0.05cm } \nopagebreak[4]
    \addcontentsline{toc}{subparagraph}{\hspace{0.5cm}{#1}}
}

\NewDocumentCommand { \myGraphic } { mmm }
{
    \begin{center}
        \includegraphics[width={#1}\textwidth]{#2}\\
        {#3}
    \end{center}
}

% Def \inlcpp
\NewDocumentCommand { \inlcpp }   { m }
{ \mintinline { cpp } { #1 } }

% Def cpp environment
%\NewDocumentEnvironment { cpp } { }
%{ \VerbatimEnvironment
    %  \begin { minted } [ linenos=true, frame=single ] { cpp } }
%{ \end   { minted } }

% Def cmake environment
\NewDocumentEnvironment { cmake } { }
{ \VerbatimEnvironment
    \begin { minted } [ linenos=true, frame=single ] { cmake } }
{ \end   { minted } }

\NewDocumentEnvironment { json } { }
{ \VerbatimEnvironment
    \begin { minted } [ linenos=true, frame=single ] { json } }
{ \end   { minted } }

% Def python environment
\NewDocumentEnvironment { python } { }
{ \VerbatimEnvironment
    \begin { minted } [ linenos=true, frame=single ] { python } }
{ \end   { minted } }

\NewDocumentEnvironment { myNotic } { m }
{ %\hspace*{\fill} \\
    \begin { tcolorbox } [ breakable,colback = blue!5!white, colframe=blue!55!black ,title={#1}] }
{ \end   { tcolorbox } }

\NewDocumentEnvironment { myTip } { m }
{ %\hspace*{\fill} \\
    \begin { tcolorbox } [ breakable,colback = green!5!white, colframe=green!45!black ,title={#1}] }
{ \end   { tcolorbox } }

\NewDocumentEnvironment { myWarning } { m }
{ %\hspace*{\fill} \\
    \begin { tcolorbox } [ breakable,colback=red!5!white,colframe=red!55!black,title={#1}] }
{ \end   { tcolorbox } }

\NewDocumentCommand { \mySubsubsection } { mm }
{
    \subsubsection*{\zihao{3} {#1} \hspace{0.2cm}{#2}}
    \addcontentsline{toc}{subsubsection}{{#1}\hspace{0.2cm}{#2}}
}

\NewDocumentCommand { \mySubsectionNoFile } { mm }
{
    \subsection*{\zihao{3}{#1}\hspace{0.2cm}{#2}}
    \addcontentsline{toc}{subsection}{{#1}\hspace{0.2cm}{#2}}
}

\NewDocumentCommand { \mySubsection } { mmm }
{
    \subsection*{\zihao{3}{#1}\hspace{0.2cm}{#2}}
    \addcontentsline{toc}{subsection}{{#1}\hspace{0.2cm}{#2}}
    \subfile{{#3}}
}

\NewDocumentCommand { \myChapterNoFile } { mm }
{
    \color{black}
    \pagecolor{white}
    \section*{\zihao{2}{#1}\hspace{0.5cm}{#2}}
    \addcontentsline{toc}{chapter}{{#1}\hspace{0.5cm}{#2}}
}

\NewDocumentCommand { \myChapterNoHeadImage } { mmm }
{
    \color{black}
    \pagecolor{white}
    \section*{\zihao{2}{#1}\hspace{0.5cm}{#2}}
    \addcontentsline{toc}{chapter}{{#1}\hspace{0.5cm}{#2}}
    \subfile{{#3}}
}

\NewDocumentCommand { \myChapter } { mmm }
{
    %\ThisULCornerWallPaper{1.0}{images/section-header.png}
    \section*{\zihao{2}{#1}\hspace{0.5cm}{#2}}
    \addcontentsline{toc}{chapter}{{#1}\hspace{0.5cm}{#2}}
    \subfile{{#3}}
}

\NewDocumentCommand { \myPart } { mmm }
{
    %\ThisCenterWallPaper{1.15}{images/section-background.png}
    \section*{\zihao{2}{#1}\hspace{0.5cm}{#2}}
    \addcontentsline{toc}{part}{{#1}\hspace{0.5cm}{#2}}
    \subfile{{#3}}
}
% Latex有三种标准文类：book, report, article. 每种文类的章节命令和层次深度如下：
% https://blog.csdn.net/z_feng12489/article/details/90755503
% book:  \part  \chapter  \section  \subsection  \subsubsection	  \paragraph  \subparagraph

% Latex如何在文本模式批量处理下划线
% https://zhuanlan.zhihu.com/p/615108006

\ExplSyntaxOff

